<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØµÙØ­Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ - Ø§Ø®ØªØ¨Ø§Ø±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 500px;
            width: 100%;
            text-align: center;
        }
        
        h1 {
            color: #667eea;
            margin-bottom: 30px;
            font-size: 28px;
        }
        
        .info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: right;
        }
        
        .info p {
            margin: 10px 0;
            color: #333;
            font-size: 16px;
        }
        
        .status {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .status.active {
            background: #d4edda;
            color: #155724;
        }
        
        .status.inactive {
            background: #f8d7da;
            color: #721c24;
        }
        
        #debug {
            display: none; /* Ù…Ø®ÙÙŠ Ù„Ù„Ø³Ø§Ø¦Ù‚ */
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: right;
            font-size: 12px;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš• Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</h1>
        
        <div class="info">
            <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> <span class="status active" id="status">Ù†Ø´Ø·</span></p>
            <p><strong>Ø§Ù„ÙˆÙ‚Øª:</strong> <span id="time"></span></p>
            <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> <span id="date"></span></p>
        </div>
        
        <p style="color: #666; margin-top: 20px;">
            Ù†ØªÙ…Ù†Ù‰ Ù„Ùƒ ÙŠÙˆÙ…Ø§Ù‹ Ù…ÙˆÙÙ‚Ø§Ù‹! ğŸŒŸ
        </p>
        
        <!-- Debug info (hidden from driver) -->
        <div id="debug">
            <p><strong>Debug Info:</strong></p>
            <p id="debugInfo">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getFirestore, doc, setDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB8Q9CYIWXPmTdiz3vPiLlPYFxiJu0vE_g",
            authDomain: "taxi-management-system-d8210.firebaseapp.com",
            projectId: "taxi-management-system-d8210",
            storageBucket: "taxi-management-system-d8210.firebasestorage.app",
            messagingSenderId: "720874424166",
            appId: "1:720874424166:web:25f9c6d126e792b2e5eaa7",
            measurementId: "G-GY8820W410"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Driver ID (ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙØ¹Ù„ÙŠØŒ Ø³ÙŠØ£ØªÙŠ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„)
        const driverId = 'TEST_DRIVER_001';
        
        // Update time display
        function updateTime() {
            const now = new Date();
            document.getElementById('time').textContent = now.toLocaleTimeString('ar-SA');
            document.getElementById('date').textContent = now.toLocaleDateString('ar-SA');
        }
        updateTime();
        setInterval(updateTime, 1000);

        // Track location
        let trackingActive = false;
        let watchId = null;

        async function sendLocation(position) {
            const locationData = {
                driverId: driverId,
                latitude: position.coords.latitude,
                longitude: position.coords.longitude,
                accuracy: position.coords.accuracy,
                speed: position.coords.speed || 0,
                heading: position.coords.heading || 0,
                timestamp: serverTimestamp(),
                localTime: new Date().toISOString()
            };

            try {
                // Save to Firestore
                await setDoc(doc(db, 'driverLocations', driverId), locationData);
                
                // Debug info (hidden)
                const debugInfo = `
                    âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹<br>
                    ğŸ“ Lat: ${position.coords.latitude.toFixed(6)}<br>
                    ğŸ“ Lng: ${position.coords.longitude.toFixed(6)}<br>
                    ğŸ¯ Accuracy: ${position.coords.accuracy.toFixed(0)}m<br>
                    â° ${new Date().toLocaleTimeString('ar-SA')}
                `;
                document.getElementById('debugInfo').innerHTML = debugInfo;
                
                console.log('Location sent:', locationData);
            } catch (error) {
                console.error('Error sending location:', error);
                document.getElementById('debugInfo').innerHTML = `âŒ Ø®Ø·Ø£: ${error.message}`;
            }
        }

        function handleLocationError(error) {
            console.error('Location error:', error);
            document.getElementById('status').textContent = 'ØºÙŠØ± Ù†Ø´Ø·';
            document.getElementById('status').className = 'status inactive';
            
            let errorMsg = '';
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    errorMsg = 'ØªÙ… Ø±ÙØ¶ Ø¥Ø°Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹';
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMsg = 'Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…ØªØ§Ø­';
                    break;
                case error.TIMEOUT:
                    errorMsg = 'Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹';
                    break;
                default:
                    errorMsg = 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            }
            
            document.getElementById('debugInfo').innerHTML = `âŒ ${errorMsg}`;
        }

        // Start tracking automatically
        if ('geolocation' in navigator) {
            // Request permission and start tracking
            watchId = navigator.geolocation.watchPosition(
                sendLocation,
                handleLocationError,
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
            
            trackingActive = true;
            console.log('Tracking started automatically');
            
            // Also send location every 10 seconds
            setInterval(() => {
                navigator.geolocation.getCurrentPosition(sendLocation, handleLocationError);
            }, 10000);
        } else {
            alert('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹');
            document.getElementById('status').textContent = 'ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…';
            document.getElementById('status').className = 'status inactive';
        }

        // Show debug info if URL contains ?debug=true
        if (window.location.search.includes('debug=true')) {
            document.getElementById('debug').style.display = 'block';
        }
    </script>
</body>
</html>

