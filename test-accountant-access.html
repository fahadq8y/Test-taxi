<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙˆØµÙˆÙ„ - Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø­Ø§Ø³Ø¨</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f3f4f6;
            padding: 2rem;
            direction: rtl;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        h1 {
            color: #059669;
            margin-bottom: 1rem;
        }
        .info-box {
            background: #f0fdf4;
            border: 1px solid #86efac;
            padding: 1rem;
            border-radius: 5px;
            margin-bottom: 1rem;
        }
        .error-box {
            background: #fef2f2;
            border: 1px solid #fca5a5;
            padding: 1rem;
            border-radius: 5px;
            margin-bottom: 1rem;
        }
        .log {
            background: #1f2937;
            color: #10b981;
            padding: 1rem;
            border-radius: 5px;
            font-family: monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        button {
            background: #059669;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            margin: 0.5rem;
        }
        button:hover {
            background: #047857;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø­Ø§Ø³Ø¨</h1>
        
        <div class="info-box">
            <strong>Ø§Ù„ØºØ±Ø¶:</strong> Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© ØªØ³Ø§Ø¹Ø¯ ÙÙŠ ØªØ´Ø®ÙŠØµ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø­Ø§Ø³Ø¨
        </div>

        <button onclick="checkAuth()">ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©</button>
        <button onclick="checkLocalStorage()">ÙØ­Øµ localStorage</button>
        <button onclick="clearAndReload()">Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„</button>
        <button onclick="testAccountantPage()">Ø§Ø®ØªØ¨Ø§Ø± ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø­Ø§Ø³Ø¨</button>

        <h3>Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«:</h3>
        <div class="log" id="log"></div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyB8Q9CYIWXPmTdiz3vPiLlPYFxiJu0vE_g",
            authDomain: "taxi-management-system-d8210.firebaseapp.com",
            projectId: "taxi-management-system-d8210",
            storageBucket: "taxi-management-system-d8210.firebasestorage.app",
            messagingSenderId: "720874424166",
            appId: "1:720874424166:web:25f9c6d126e792b2e5eaa7",
            measurementId: "G-GY8820W410"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const logDiv = document.getElementById('log');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('ar-SA');
            const color = type === 'error' ? '#ef4444' : type === 'success' ? '#10b981' : '#60a5fa';
            logDiv.innerHTML += `<span style="color: ${color}">[${timestamp}] ${message}</span>\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        window.checkAuth = function() {
            log('ğŸ” Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©...', 'info');
            
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    log('âœ… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„', 'success');
                    log(`   - UID: ${user.uid}`, 'info');
                    log(`   - Email: ${user.email}`, 'info');
                    
                    try {
                        const userDoc = await getDoc(doc(db, 'users', user.uid));
                        if (userDoc.exists()) {
                            const userData = userDoc.data();
                            log('âœ… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Firestore', 'success');
                            log(`   - Ø§Ù„Ø§Ø³Ù…: ${userData.name}`, 'info');
                            log(`   - Ø§Ù„Ø¯ÙˆØ±: ${userData.role}`, 'info');
                            log(`   - Ù†Ø´Ø·: ${userData.active}`, 'info');
                        } else {
                            log('âŒ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Firestore!', 'error');
                        }
                    } catch (error) {
                        log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${error.message}`, 'error');
                    }
                } else {
                    log('âŒ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„', 'error');
                }
            });
        };

        window.checkLocalStorage = function() {
            log('ğŸ” Ø¬Ø§Ø±ÙŠ ÙØ­Øµ localStorage...', 'info');
            
            const userRole = localStorage.getItem('userRole');
            const userName = localStorage.getItem('userName');
            const userId = localStorage.getItem('userId');
            
            if (userRole || userName || userId) {
                log('âœ… Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ localStorage:', 'success');
                log(`   - userRole: ${userRole}`, 'info');
                log(`   - userName: ${userName}`, 'info');
                log(`   - userId: ${userId}`, 'info');
            } else {
                log('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ localStorage', 'info');
            }
        };

        window.clearAndReload = function() {
            log('ğŸ—‘ï¸ Ø¬Ø§Ø±ÙŠ Ù…Ø³Ø­ localStorage...', 'info');
            localStorage.clear();
            log('âœ… ØªÙ… Ù…Ø³Ø­ localStorage', 'success');
            log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø®Ù„Ø§Ù„ 2 Ø«Ø§Ù†ÙŠØ©...', 'info');
            setTimeout(() => {
                window.location.reload();
            }, 2000);
        };

        window.testAccountantPage = function() {
            log('ğŸš€ Ù…Ø­Ø§ÙˆÙ„Ø© ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø­Ø§Ø³Ø¨...', 'info');
            window.location.href = 'accountant-dashboard.html';
        };

        // Auto-check on load
        log('=== Ø¨Ø¯Ø¡ Ø§Ù„ÙØ­Øµ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ===', 'info');
        checkAuth();
        checkLocalStorage();
    </script>
</body>
</html>

