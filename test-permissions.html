<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }

        .test-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .test-section h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .test-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .test-label {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .test-value {
            color: #666;
            font-family: monospace;
        }

        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 10px;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .status.warning {
            background: #fff3cd;
            color: #856404;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }

        button:hover {
            opacity: 0.9;
        }

        .controls {
            text-align: center;
            margin-bottom: 20px;
        }

        select {
            padding: 10px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
            font-size: 14px;
            margin: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”’ Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</h1>

        <div class="controls">
            <label>Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆØ± Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±:</label>
            <select id="roleSelect" onchange="changeRole()">
                <option value="">-- Ø§Ø®ØªØ± Ø¯ÙˆØ± --</option>
                <option value="admin">Ù…Ø¯ÙŠØ± (Admin)</option>
                <option value="accountant">Ù…Ø­Ø§Ø³Ø¨ (Accountant)</option>
                <option value="driver">Ø³Ø§Ø¦Ù‚ (Driver)</option>
            </select>
            <button onclick="runTests()">ğŸ§ª ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</button>
        </div>

        <div class="test-section">
            <h2>ğŸ“Š Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ</h2>
            <div class="test-item">
                <div class="test-label">Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠ:</div>
                <div class="test-value" id="currentRole">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</div>
            </div>
            <div class="test-item">
                <div class="test-label">Ø­Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:</div>
                <div class="test-value" id="loginStatus">ØºÙŠØ± Ù…Ø³Ø¬Ù„</div>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</h2>
            <div id="testResults"></div>
        </div>

        <div class="test-section">
            <h2>â° Ø§Ø®ØªØ¨Ø§Ø± Ù‚ÙŠÙˆØ¯ Ø§Ù„ÙˆÙ‚Øª</h2>
            <div id="timeTests"></div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="user-permissions.js"></script>
    <script>
        // ØªÙ‡ÙŠØ¦Ø© Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyB8Q9CYIWXPmTdiz3vPiLlPYFxiJu0vE_g",
            authDomain: "taxi-management-system-d8210.firebaseapp.com",
            projectId: "taxi-management-system-d8210",
            storageBucket: "taxi-management-system-d8210.firebasestorage.app",
            messagingSenderId: "720874424166",
            appId: "1:720874424166:web:25f9c6d126e792b2e5eaa7",
            measurementId: "G-GY8820W410"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function updateUserInfo() {
            const role = getUserRoleSync();
            document.getElementById('currentRole').textContent = role || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            document.getElementById('loginStatus').textContent = role ? 'Ù…Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„' : 'ØºÙŠØ± Ù…Ø³Ø¬Ù„';
        }

        // ØªØºÙŠÙŠØ± Ø§Ù„Ø¯ÙˆØ± Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
        function changeRole() {
            const role = document.getElementById('roleSelect').value;
            if (role) {
                localStorage.setItem('userRole', role);
                updateUserInfo();
            }
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
        function runTests() {
            const role = getUserRoleSync();
            if (!role) {
                alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¯ÙˆØ± Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }

            let results = '';

            // Ø§Ø®ØªØ¨Ø§Ø± 1: ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø­Ø°Ù Ù„Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø­Ø¯ÙŠØ«Ø©
            const now = new Date();
            const canDeleteRecent = canDelete(now);
            results += createTestResult(
                'Ø­Ø°Ù Ø¹Ù†ØµØ± Ø­Ø¯ÙŠØ« (Ø§Ù„Ø¢Ù†)',
                canDeleteRecent,
                role === 'admin' || role === 'accountant',
                `ÙŠÙ…ÙƒÙ† Ø§Ù„Ø­Ø°Ù: ${canDeleteRecent ? 'Ù†Ø¹Ù…' : 'Ù„Ø§'}`
            );

            // Ø§Ø®ØªØ¨Ø§Ø± 2: ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø­Ø°Ù Ù„Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© (48 Ø³Ø§Ø¹Ø©)
            const twoDaysAgo = new Date(now - 48 * 60 * 60 * 1000);
            const canDeleteOld = canDelete(twoDaysAgo);
            results += createTestResult(
                'Ø­Ø°Ù Ø¹Ù†ØµØ± Ù‚Ø¯ÙŠÙ… (48 Ø³Ø§Ø¹Ø©)',
                canDeleteOld,
                role === 'admin',
                `ÙŠÙ…ÙƒÙ† Ø§Ù„Ø­Ø°Ù: ${canDeleteOld ? 'Ù†Ø¹Ù…' : 'Ù„Ø§'}`
            );

            // Ø§Ø®ØªØ¨Ø§Ø± 3: ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø­Ø°Ù Ù„Ù„Ø¹Ù†Ø§ØµØ± ÙÙŠ Ø­Ø¯ÙˆØ¯ 24 Ø³Ø§Ø¹Ø©
            const twentyHoursAgo = new Date(now - 20 * 60 * 60 * 1000);
            const canDeleteWithin24 = canDelete(twentyHoursAgo);
            results += createTestResult(
                'Ø­Ø°Ù Ø¹Ù†ØµØ± (20 Ø³Ø§Ø¹Ø©)',
                canDeleteWithin24,
                role === 'admin' || role === 'accountant',
                `ÙŠÙ…ÙƒÙ† Ø§Ù„Ø­Ø°Ù: ${canDeleteWithin24 ? 'Ù†Ø¹Ù…' : 'Ù„Ø§'}`
            );

            document.getElementById('testResults').innerHTML = results;

            // Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ÙˆÙ‚Øª
            runTimeTests();
        }

        // Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ù‚ÙŠÙˆØ¯ Ø§Ù„ÙˆÙ‚Øª
        function runTimeTests() {
            let timeResults = '';
            const now = new Date();

            const testTimes = [
                { label: 'Ø§Ù„Ø¢Ù†', hours: 0 },
                { label: '12 Ø³Ø§Ø¹Ø©', hours: 12 },
                { label: '23 Ø³Ø§Ø¹Ø©', hours: 23 },
                { label: '24 Ø³Ø§Ø¹Ø©', hours: 24 },
                { label: '25 Ø³Ø§Ø¹Ø©', hours: 25 },
                { label: '48 Ø³Ø§Ø¹Ø©', hours: 48 }
            ];

            testTimes.forEach(test => {
                const testDate = new Date(now - test.hours * 60 * 60 * 1000);
                const canDeleteIt = canDeleteWithinTimeLimit(testDate);
                const expected = test.hours <= 24;
                
                timeResults += createTestResult(
                    `Ù‚ÙŠØ¯ Ø§Ù„ÙˆÙ‚Øª: ${test.label}`,
                    canDeleteIt === expected,
                    true,
                    `Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${canDeleteIt ? 'Ø¶Ù…Ù† 24 Ø³Ø§Ø¹Ø©' : 'Ø®Ø§Ø±Ø¬ 24 Ø³Ø§Ø¹Ø©'}`
                );
            });

            document.getElementById('timeTests').innerHTML = timeResults;
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ù†ØªÙŠØ¬Ø© Ø§Ø®ØªØ¨Ø§Ø±
        function createTestResult(name, passed, expected, details) {
            const status = passed === expected ? 'success' : 'error';
            const statusText = passed === expected ? 'âœ“ Ù†Ø¬Ø­' : 'âœ— ÙØ´Ù„';
            
            return `
                <div class="test-item">
                    <span class="status ${status}">${statusText}</span>
                    <strong>${name}</strong>
                    <div class="test-value">${details}</div>
                </div>
            `;
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        updateUserInfo();
    </script>
</body>
</html>

